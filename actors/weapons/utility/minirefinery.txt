/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Mini-Refinery
 *
 * The utility-built mini-refinery is a credit flow booster. Must be built into
 * a tiberium field, in which it will start to refine the crystals there and
 * turning them into cash for you and your friends. A good thing to have around
 * when the main Refinery is destroyed. Credit flow is boosted by 75% when
 * the mini-refinery is active.
 */

actor Utility_MiniRefCacheRed {
	+SHOOTABLE +NOBLOOD
	+ACTIVATEMCROSS +DONTGIB
	+NOICEDEATH +NOGRAVITY
	+ISMONSTER +QUICKTORETALIATE
	obituary "%o ventured too close to the \cARed Mini-Refinery\c-."
	Radius 32 Height 48
	Health 6500
	renderstyle Translucent
	alpha 0.0
	scale 0.1875
	mass 0x7FFFFFFF
	painchance 255
	damagetype ChemicalSpecial
	damagefactor "Fist", 0.0		damagefactor "Fist", 0.2
	damagefactor "Bullet", 0.0		damagefactor "Bullet", 0.5
	damagefactor "Rifle", 0.0		damagefactor "Rifle", 0.5
	damagefactor "Explosion", 0.0	damagefactor "Explosion", 0.75
	damagefactor "Fire", 0.0		damagefactor "Fire", 0.6
	damagefactor "Chemical", 0.0		damagefactor "Chemical", 0.0
	damagefactor "Laser", 0.0		damagefactor "Laser", 1.0
	damagefactor "RazorWire", 0.0	damagefactor "RazorWire", 0.0
	damagefactor "ExplosionMech", 0.0	damagefactor "ExplosionMech", 0.25
	damagefactor "TimeRed", 0.0		damagefactor "TimeBlue", 1.0
	damagefactor "Disarm", 0.0		damagefactor "Flash", 0.0
	damagefactor "Superweapon", 0.0		damagefactor "SuperweaponIon", 1.0
	damagefactor "Artillery", 0.0	damagefactor "Artillery", 0.75
	damagefactor "ChemicalSpecial", 0.0
	damagefactor "Deconstruction",	1.0
	damagefactor "Mechstomp", 0.0
	damagefactor "Monster", 0.0
	States {
	Spawn:
		MREF AA 0 Thing_ChangeTID(0,900)
		MREF AAAAAAAAAA 3 A_FadeIn(0.1)
		NULL A 0 A_SetTranslucent(1.0,0)
		MREF A -1 A_Gravity // wait until the script approves the cache.
		stop
	Approved:
		MREF A 5 A_RadiusThrust (4000, 40, 1)
		NULL A 0 A_ChangeFlag("NOCLIP", 0)
		NULL A 0 A_SetSolid
		NULL A 0 A_SpawnItemEx("MiniRefCacheFlare",0,0,48,0,0,0,128,0)
		MREF A 35 A_PlaySound("misc/i_pkup")
		NULL A 0 A_ChangeFlag("FRIENDLY",0)
		goto Working
	Working:
		MREF A 35 A_SpawnItemEx("MiniRefCacheFlare",0,0,48,0,0,0,128,0)
		loop
	Pain:
		NULL A 0 ACS_ExecuteAlways (930, 0, BUILDING_MINIREF, TEAM_RED)
		MREF A 1 A_Stop
		goto Working
	Death:  
		NULL A 0 
		NULL A 0 A_NoBlocking
		NULL A 0 A_Explode (256, 512)
		NULL A 0 A_PlaySound ("weapons/rocklx", CHAN_ITEM)
		NULL A 0 A_SpawnItemEx ("ExplosionMainLarge", 0, 0, 32, 0, 0, 0, 0, 128)
		TNT1 AAAA 0 A_SpawnItemEx ("AnthraxDecay", random(-48,48), random(-48,48), 4)
		NULL A 4 bright 
		stop
	Disapproved:
	Death.Deconstruction:
		"----" A 2 A_PlaySound ("utility/deconstruct")
		"----" AAAAAAAAAA 2 A_Fadeout(0.1)
		stop
	}
}

ACTOR Utility_MiniRefCacheBlue : Utility_MiniRefCacheRed {
	obituary "%o ventured too close to the \cNBlue Mini-Refinery\c-."
	damagefactor "Fist", 0.2		damagefactor "Fist", 0.0
	damagefactor "Bullet", 0.5		damagefactor "Bullet", 0.0
	damagefactor "Rifle", 0.5		damagefactor "Rifle", 0.0
	damagefactor "Explosion", 0.75	damagefactor "Explosion", 0.0
	damagefactor "Fire", 0.6		damagefactor "Fire", 0.0
	damagefactor "Laser", 1.0		damagefactor "Laser", 0.0
	damagefactor "RazorWire", 0.0	damagefactor "RazorWire", 0.0
	damagefactor "ExplosionMech", 0.25	damagefactor "ExplosionMech", 0.0
	damagefactor "TimeRed", 1.0		damagefactor "TimeBlue", 0.0
	damagefactor "Superweapon", 1.0		damagefactor "SuperweaponIon", 0.0
	damagefactor "Artillery", 0.75	damagefactor "Artillery", 0.0
	states {
	Spawn:
		MREF AA 0 Thing_ChangeTID(0,901)
		MREF AAAAAAAAAA 3 A_FadeIn(0.1)
		NULL A 0 A_SetTranslucent(1.0,0)
		MREF A -1 A_Gravity // wait until the script approves the cache.
		stop
	Pain:
		NULL A 0 ACS_ExecuteAlways (930, 0, BUILDING_MINIREF, TEAM_BLUE)
		MREF A 1 A_Stop
		goto Working
	}
}