// Fists
actor Unarmed : AOWWeapon {
	+WIMPY_WEAPON
	+MELEEWEAPON
	obituary "%k knocked %o out hard."
	inventory.pickupmessage "You got a fist."
	dropitem "Nothing"
	weapon.kickback 165
	weapon.selectionorder 20
	weapon.PreferredSkin "MarineFist"
	states {
	Ready:
		PUNG A 1 A_WeaponReady
		loop
	Deselect:
		NULL A 0 A_Lower
		PUNG A 1 A_Lower
		loop
	Select:
		NULL A 0 A_JumpIfInventory ("PowerBerserk", 1, "Remove")
		NULL A 0 A_JumpIfInventory ("FistReplaced", 1, "ReplaceCleanup")
		NULL A 0 A_Raise
		PUNG A 1 A_Raise
		goto Select+2
	Fire:
		NULL A 0 A_JumpIfInventory("IsBlue",1,"FireBlue")
		PUNG B 2 A_JumpIfInventory("FistSwitch",1,6)
		PUNG C 2
		NULL A 0 A_GiveInventory("FistSwitch",1)
		PUNG D 5 A_CustomPunch(35,1,1,"FistPuff",64)
		PUNG C 2
		PUNG B 5 A_ReFire
		goto Ready
		PUNG E 2
		PUNG F 2
		NULL A 0 A_TakeInventory("FistSwitch",1)
		PUNG G 5 A_CustomPunch(35,1,1,"FistPuff",64)
		PUNG F 2
		PUNG E 5 A_ReFire
		goto Ready
	FireBlue:
		PUNG B 2 A_JumpIfInventory("FistSwitch",1,6)
		PUNG C 2
		NULL A 0 A_GiveInventory("FistSwitch",1)
		PUNG D 5 A_CustomPunch(35,1,1,"FistPuffBlue",64)
		PUNG C 2
		PUNG B 5 A_ReFire
		goto Ready
		PUNG E 2
		PUNG F 2
		NULL A 0 A_TakeInventory("FistSwitch",1)
		PUNG G 5 A_CustomPunch(35,1,1,"FistPuffBlue",64)
		PUNG F 2
		PUNG E 5 A_ReFire
		goto Ready
	Remove:
		PUNG A 1 offset (1,32)
		NULL A 0 A_GiveInventory ("BerserkFists", 1)
		NULL A 0 A_SelectWeapon ("BerserkFists")
		NULL A 0 A_GiveInventory ("FistReplaced", 1)
		goto Deselect
	ReplaceCleanup:
		NULL A 0 A_TakeInventory ("BerserkFists", 1)
		NULL A 0 A_TakeInventory ("FistReplaced", 1)
		goto Select
	Spawn:
		NULL A 0
		stop
	}
}

actor BerserkFists : Unarmed {
	-WIMPY_WEAPON // well it's not, is it?
	obituary "\cG%o \cGgot %p SHIT punched the fuck out by %k."
	weapon.selectionorder 0
	states {
	Select:
		PUNG A 5
		NULL A 0 A_JumpIfInventory ("PowerBerserk", 1, 1)
		goto Remove
		NULL A 0 A_JumpIfInventory ("FistReplaced", 1, "ReplaceCleanup")
		NULL A 0 A_Raise
		PUNG A 1 A_Raise
		goto Select+4
	Ready:
		PUNG A 1 A_WeaponReady (WRF_NOSWITCH)
		wait
	Fire:
		NULL A 0 A_JumpIfInventory("IsBlue",1,"Fire.Blue")
		NULL A 0 A_JumpIfInventory("FistSwitch", 1, "Fire2")
		PUNG B 1 Offset(-30,40)
		PUNG B 1 Offset(-24,38)
		//PUNG C 1 Offset(-16,36)
		PUNG C 1 Offset(-9,35)
		NULL A 0 A_GiveInventory ("FistSwitch", 1)
		PUNG D 1 Offset(0,33) A_CustomPunch (250, 1, 1, "BerserkPuff", 135)
		PUNG D 1 Offset(15,32)
		//PUNG C 1 Offset(10,37)
		PUNG C 1 Offset(5,38)
		PUNG B 1 Offset(0,39) A_ReFire
		goto Ready
	Fire2:
		PUNG E 1 Offset(30,40)
		PUNG E 1 Offset(24,38)
		//PUNG F 1 Offset(16,36)
		PUNG F 1 Offset(9,35)
		NULL A 0 A_GiveInventory ("FistSwitch", 1)
		PUNG G 1 Offset(0,33) A_CustomPunch (250, 1, 1, "BerserkPuff", 135)
		PUNG G 1 Offset(-5,32)
		//PUNG F 1 Offset(1,37)
		PUNG F 1 Offset(6,38) A_TakeInventory("FistSwitch",1)
		PUNG E 1 Offset(10,39) A_ReFire
		goto Ready
	Fire.Blue:
		NULL A 0 A_JumpIfInventory("FistSwitch", 1, "Fire.Blue2")
		PUNG B 1 Offset(-30,40)
		PUNG B 1 Offset(-24,38)
		//PUNG C 1 Offset(-16,36)
		PUNG C 1 Offset(-9,35)
		NULL A 0 A_GiveInventory ("FistSwitch", 1)
		PUNG D 1 Offset(0,33) A_CustomPunch (250, 1, 1, "BerserkPuffBlue", 135)
		PUNG D 1 Offset(15,32)
		//PUNG C 1 Offset(10,37)
		PUNG C 1 Offset(5,38)
		PUNG B 1 Offset(0,39) A_ReFire
		goto Ready
	Fire.Blue2:
		PUNG E 1 Offset(30,40)
		PUNG E 1 Offset(24,38)
		//PUNG F 1 Offset(16,36)
		PUNG F 1 Offset(9,35)
		NULL A 0 A_GiveInventory ("FistSwitch", 1)
		PUNG G 1 Offset(0,33) A_CustomPunch (250, 1, 1, "BerserkPuffBlue", 135)
		PUNG G 1 Offset(-5,32)
		//PUNG F 1 Offset(1,37) 
		PUNG F 1 Offset(6,38) A_TakeInventory("FistSwitch",1)
		PUNG E 1 Offset(10,39) A_ReFire
		goto Ready
	Remove:
		PUNG A 1 offset (1,32)
		NULL A 0 A_GiveInventory ("Unarmed", 1)
		NULL A 0 A_SelectWeapon ("Unarmed")
		NULL A 0 A_GiveInventory ("FistReplaced", 1)
		goto Deselect
	ReplaceCleanup:
		NULL A 0 A_TakeInventory ("Unarmed", 1)
		NULL A 0 A_TakeInventory ("FistReplaced", 1)
		goto Select
	}
}

actor FistSwitch : Boolean {}
actor FistReplaced : Boolean {}

actor FistPuff : BulletPuff {
	+CLIENTSIDEONLY
	+NOBLOCKMAP
	+NOGRAVITY
	-ALLOWPARTICLES
	+PUFFONACTORS
	DamageType "Fist"
	states {
	Crash:
		NULL A 0 bright
		PUFF A 4 bright A_SpawnItem ("FistWall")
		PUFF B 4 
		PUFF CD 4
		stop
	Melee:
		NULL A 0 bright
		PUFF A 4 bright A_SpawnItem ("FistHit")
		stop
	Spawn:
		NULL A 0 bright
		PUFF A 4 bright A_SpawnItem ("FistHit")
		stop
	}
}

actor FistPuffBlue : FistPuff {DamageType "Fist"}
actor BerserkPuff : FistPuff {
	+EXTREMEDEATH
	States {
	Melee:
		NULL A 0
		NULL A 0 bright A_SpawnItem ("FistHit")
		stop
	}
}
actor BerserkPuffBlue : BerserkPuff { DamageType "Fist" }

actor FistHit {
	+CLIENTSIDEONLY
	+NOCLIP
	radius 1
	height 1
	states {
	Spawn:
		NULL A 0
		NULL A 1 A_PlaySound("fist/hit")
		stop
	}
}

actor FistWall : FistHit {
	states {
	Spawn:
		NULL A 0
		NULL A 1 A_PlaySound("fist/wall")
		stop
	}
}