/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Obelisk of Light
 *
 * The Obelisk is a tower-like structure that guards the base. It exists at
 * game start and is one of the five structures that must be destroyed to win
 * the game.
 *
 * The Obelisk structure is built of map geometry. The actors defined here are
 * invisible actors that are the functional bit in the obelisk. They're monsters
 * which shoot the plasma blast at enemies they see.
 */

actor RedObeliskThing 21214 {
	obituary "$OB_OBELISK_RED" // "%o was vaporized by the \cgRed Obelisk\c-."
	health 99999
	radius 16
	height 64
	Mass 999999
	speed 0
	painchance 0
	MONSTER
	-ISMONSTER
	+FLOORCLIP
	+NOBLOOD
	+NOICEDEATH
	-SOLID
	+NOCLIP
	-FRIENDLY
	+NOTARGET
	+LOOKALLAROUND
	+NEVERRESPAWN
	+NOGRAVITY
	+NOINTERACTION
	states
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 Thing_ChangeTID (0, 215)
		TNT1 A 0 A_ChangeFlag("ISMONSTER",1)
		TNT1 A 0 A_GiveInventory("IsRed",1)
		TNT1 A 0 A_TakeInventory("ObeliskCharged",1)
		TNT1 A 8 A_Look
		loop
	See:
		TNT1 A 0 A_Chase("","",CHF_DONTMOVE)
		TNT1 A 0 A_GiveInventory("IsRed",1)
		TNT1 A 0 A_TakeInventory("ObeliskCharged",1)
		TNT1 A 3 A_FaceTarget
		TNT1 A 2 A_JumpIfTargetInLOS("Missile")
		TNT1 A 2 A_ClearTarget
		goto Spawn
	See2:
		TNT1 A 2 A_ClearTarget
		goto See
	MissileCheck:
		TNT1 AA 0 A_JumpIfInTargetInventory("IsBlue",1,"MissileGo")
		TNT1 A 0 
		goto See
	Missile:
		TNT1 A 0 
		TNT1 A 1 A_JumpIfInTargetInventory("IsRed",1,"See2")
		TNT1 A 1 A_JumpIfCloser(30000,"MissileGo")
		TNT1 A 0 
		goto See2
	MissileGo:
		TNT1 A 0 A_JumpIfInTargetInventory("IsMech",1,"MissileGoMech")
		TNT1 A 0 A_JumpIfInventory("ObeliskCharged",1,"MissileCharged")
		TNT1 A 0 A_FaceTarget
		TNT1 A 70 A_PlaySoundEx("obelisk/charge","Voice",0)
		TNT1 A 0 A_GiveInventory("ObeliskCharged",15)
		TNT1 A 0 A_CposRefire
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_SpawnItemEx("ObbyFlare")
		TNT1 A 0 A_CustomMissile("ObeliskShotRedInfantry",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileCharged:
		TNT1 A 15
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_CustomMissile("ObeliskShotRedInfantry",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileGoMech:
		TNT1 A 0 A_JumpIfInventory("ObeliskCharged",1,"MissileChargedMech")
		TNT1 A 0 A_FaceTarget
		TNT1 A 70 A_PlaySoundEx("obelisk/charge","Voice",0)
		TNT1 A 0 A_GiveInventory("ObeliskCharged",15)
		TNT1 A 0 A_CposRefire
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_SpawnItemEx("ObbyFlare")
		TNT1 A 0 A_CustomMissile("ObeliskShotRed",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileChargedMech:
		TNT1 A 15
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_CustomMissile("ObeliskShotRed",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	Death:	
		TNT1 A 5
		stop
	}
}

actor BlueObeliskThing 21213 
{
	obituary "$OB_OBELISK_BLUE" // "%o was vaporized by the \chBlue Obelisk\c-."
	health 99999
	radius 16
	height 64
	Mass 999999
	speed 0
	painchance 0
	MONSTER
	-ISMONSTER
	+FLOORCLIP
	+NOBLOOD
	+NOICEDEATH
	-SOLID
	+NOCLIP
	-FRIENDLY
	+NOTARGET
	+LOOKALLAROUND
	+NEVERRESPAWN
	+NOGRAVITY
	+NOINTERACTION
	states
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 Thing_ChangeTID (0, 115)
		TNT1 A 0 A_ChangeFlag("ISMONSTER",1)
		TNT1 A 0 A_GiveInventory("IsBlue",1)
		TNT1 A 0 A_TakeInventory("ObeliskCharged",1)
		TNT1 A 8 A_Look
		loop
	See:
		TNT1 A 0 A_Chase("","",CHF_DONTMOVE)
		TNT1 A 0 A_GiveInventory("IsBlue",1)
		TNT1 A 0 A_TakeInventory("ObeliskCharged",1)
		TNT1 A 3 A_FaceTarget
		TNT1 A 2 A_JumpIfTargetInLOS("Missile")
		TNT1 A 2 A_ClearTarget
		goto Spawn
	See2:
		TNT1 A 2 A_ClearTarget
		goto See
	MissileCheck:
		TNT1 AA 0 A_JumpIfInTargetInventory("IsRed",1,"MissileGo")
		TNT1 A 0 
		goto See
	Missile:
		TNT1 A 0 
		TNT1 A 1 A_JumpIfInTargetInventory("IsBlue",1,"See2")
		TNT1 A 1 A_JumpIfCloser(30000,"MissileGo")
		TNT1 A 0 
		goto See2
	MissileGo:
		TNT1 A 0 A_JumpIfInTargetInventory("IsMech",1,"MissileGoMech")
		TNT1 A 0 A_JumpIfInventory("ObeliskCharged",1,"MissileCharged")
		TNT1 A 0 A_FaceTarget
		TNT1 A 70 A_PlaySoundEx("obelisk/charge","Voice",0)
		TNT1 A 0 A_GiveInventory("ObeliskCharged",15)
		TNT1 A 0 A_CposRefire
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_SpawnItemEx("ObbyFlareBlue")
		TNT1 A 0 A_CustomMissile("ObeliskShotBlueInfantry",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileCharged:
		TNT1 A 15
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_CustomMissile("ObeliskShotBlueInfantry",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileGoMech:
		TNT1 A 0 A_JumpIfInventory("ObeliskCharged",1,"MissileChargedMech")
		TNT1 A 0 A_FaceTarget
		TNT1 A 70 A_PlaySoundEx("obelisk/charge","Voice",0)
		TNT1 A 0 A_GiveInventory("ObeliskCharged",15)
		TNT1 A 0 A_CposRefire
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_SpawnItemEx("ObbyFlareBlue")
		TNT1 A 0 A_CustomMissile("ObeliskShotBlue",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	MissileChargedMech:
		TNT1 A 15
		TNT1 A 0 A_PlaySoundEx("obelisk/fire","Weapon",0)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Body",0)
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_CustomMissile("ObeliskShotBlue",12,0)
		TNT1 A 70 A_FaceTarget
		TNT1 A 0 A_TakeInventory("ObeliskCharged",15)
		TNT1 A 0 A_PlaySoundEx("obelisk/charge","Voice",0)
		goto See
	Death:	
		TNT1 A 5
		stop
	}
}

Actor ObbyFlare
{
	RenderStyle Add
	+NOINTERACTION
	+CLIENTSIDEONLY
	Scale 2.0
	States
	{
	Spawn:
		CACH B 8 BRIGHT
		CACH B 1 BRIGHT A_Fadeout(0.05)
		Wait
	}
}

Actor ObbyFlareBlue
{
	RenderStyle Add
	+NOINTERACTION
	+CLIENTSIDEONLY
	Scale 2.0
	States
	{
	Spawn:
		PPCX A 8 BRIGHT
		PPCX A 1 BRIGHT A_Fadeout(0.05)
		Wait
	}
}

actor ObeliskCharged : Inventory
{
		inventory.amount 0
		inventory.maxamount 15
}

actor ObeliskShotRed : FastProjectile
{
	radius 13
	height 8
	speed 2000
	damage (250)
	renderstyle Add
	alpha 0.75
	PROJECTILE
	-RANDOMIZE
	+NOEXTREMEDEATH
	+THRUGHOST
	Scale 1.0
	DamageType "ExplosionRed"
	translation "192:207=169:189", "240:246=45:47", "112:127=176:191"
	states
	{
	Spawn:
		TNT1 A 1 bright A_SpawnItemEx("PlasmaFlameTail", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		loop
	Death:
		PLE1 C 0 A_SpawnItemEx ("PlasmaFlameCluster", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		TNT1 A 3 bright A_Explode(250,256)
		stop
	}
}

actor ObeliskShotRedInfantry : FastProjectile
{
	radius 13
	height 8
	speed 2000
	damage (40)
	renderstyle Add
	alpha 0.75
	PROJECTILE
	-RANDOMIZE
	+NOEXTREMEDEATH
	+THRUGHOST
	Scale 1.0
	DamageType "Superweapon"
	translation "192:207=169:189", "240:246=45:47", "112:127=176:191"
	states
	{
	Spawn:
		TNT1 A 1 bright A_SpawnItemEx("PlasmaFlameTail", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		loop
	Death:
		PLE1 C 0 A_SpawnItemEx ("PlasmaFlameCluster", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		TNT1 A 3 bright A_Explode(50,256)
		stop
	}
}

actor ObeliskShotBlue : FastProjectile
{
	radius 13
	height 8
	speed 2000
	damage (250)
	renderstyle Add
	alpha 0.75
	PROJECTILE
	-RANDOMIZE
	+NOEXTREMEDEATH
	+THRUGHOST
	Scale 1.0
	DamageType "ExplosionBlue"
	translation "112:120=200:207", "121:127=241:247"
	states
	{
	Spawn:
		TNT1 A 1 bright A_SpawnItemEx("PlasmaFlameTail", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		loop
	Death:
		PLE1 C 0 A_SpawnItemEx ("PlasmaFlameCluster", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		TNT1 A 3 bright A_Explode(250,256)
		stop
	}
}

actor ObeliskShotBlueInfantry : FastProjectile
{
	radius 13
	height 8
	speed 2000
	damage (40)
	renderstyle Add
	alpha 0.75
	PROJECTILE
	-RANDOMIZE
	+NOEXTREMEDEATH
	+THRUGHOST
	Scale 1.0
	DamageType "SuperweaponIon"
	translation "112:120=200:207", "121:127=241:247"
	states
	{
	Spawn:
		TNT1 A 1 bright A_SpawnItemEx("PlasmaFlameTail", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		loop
	Death:
		PLE1 C 0 A_SpawnItemEx ("PlasmaFlameCluster", 0, 0, 0, 0, 0, 0, 0, SXF_TRANSFERTRANSLATION)
		TNT1 A 3 bright A_Explode(50,256)
		stop
	}
}

// ------------------------
// Obelisk decorations
actor ObeliskVoltageDecorSpawner 29010 {
	+NOINTERACTION
	+NOBLOCKMAP
	+SHOOTABLE
	health 999999
	states {
	Spawn:
		TNT1 A 0
		TNT1 A 60 A_SpawnItemEx ("ObeliskVoltageDecor")
		loop
	Death:
		TNT1 A 0
		stop
	}
}

actor ObeliskVoltageDecor {
	+NOINTERACTION
	+CLIENTSIDEONLY
	+NOBLOCKMAP
	reactiontime 35
	states {
	Spawn:
		TNT1 AAAAAA 1 A_SpawnItemEx ("ObeliskVoltageDecorFX", random (-96,96), random (-96,96), -224, 0, 0, 25)
		TNT1 A 0 A_Countdown
		loop
	Death:
		TNT1 A 0
		stop
	}
}

actor ObeliskVoltageDecorFX {
	+FORCEXYBILLBOARD
	+CLIENTSIDEONLY
	radius 1
	height 1
	renderstyle add
	alpha 1.0
	scale 0.75
	states {
	Spawn:
		VOLX ABCDEFEDCB 2 BRIGHT A_FadeOut(0.1)
		stop
	}
}

actor ObeliskVoltageDecorSpawnerRound 29013 {
	+NOINTERACTION
	+NOBLOCKMAP
	+SHOOTABLE
	health 999999
	states {
	Spawn:
		TNT1 A 0
		TNT1 A 60 A_SpawnItemEx ("ObeliskVoltageDecorRound")
		loop
	Death:
		TNT1 A 0
		stop
	}
}

actor ObeliskVoltageDecorRound {
	+NOINTERACTION
	+CLIENTSIDEONLY
	+NOBLOCKMAP
	reactiontime 14
	states {
	Spawn:
		TNT1 AAAAA 1 A_SpawnItemEx ("ObeliskVoltageDecorFX", random (0, 160), 0, -224, 0, 0, 25, random (0, 360))
		TNT1 A 0 A_Countdown
		loop
	Death:
		TNT1 A 0
		stop
	}
}
